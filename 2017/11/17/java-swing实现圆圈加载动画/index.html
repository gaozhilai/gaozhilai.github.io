<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
    <style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      java swing实现圆圈加载动画 | zlGao的笔记 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="zlgao">
    
    

    <meta name="description" content="疑问一直很疑惑java怎么实现进度条,最近工作需要找到了一个前人实现的swing加载动画,现在整理下来,一为备份,二为后人之路.   解决方案:下面是所需要的工具类InfiniteProgressPanel: import java.awt.Color; import java.awt.Graphics; import java.awt.Graphics2D; import java.awt.Re">
<meta name="keywords" content="swing,加载动画,开源小工具">
<meta property="og:type" content="article">
<meta property="og:title" content="java swing实现圆圈加载动画 | zlGao的笔记">
<meta property="og:url" content="http://yoursite.com/2017/11/17/java-swing实现圆圈加载动画/index.html">
<meta property="og:site_name" content="zlGao的笔记">
<meta property="og:description" content="疑问一直很疑惑java怎么实现进度条,最近工作需要找到了一个前人实现的swing加载动画,现在整理下来,一为备份,二为后人之路.   解决方案:下面是所需要的工具类InfiniteProgressPanel: import java.awt.Color; import java.awt.Graphics; import java.awt.Graphics2D; import java.awt.Re">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-11-17T06:54:14.508Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="java swing实现圆圈加载动画 | zlGao的笔记">
<meta name="twitter:description" content="疑问一直很疑惑java怎么实现进度条,最近工作需要找到了一个前人实现的swing加载动画,现在整理下来,一为备份,二为后人之路.   解决方案:下面是所需要的工具类InfiniteProgressPanel: import java.awt.Color; import java.awt.Graphics; import java.awt.Graphics2D; import java.awt.Re">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">zlGao的笔记</a></h1>
        <hr class="panel-cover__divider" />

        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">首页</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">关于</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">归档</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">java swing实现圆圈加载动画</h1>

    

    <div class="post-meta">
      <time datetime="2017-11-17" class="post-meta__date date">2017-11-17</time> 

      <span class="post-meta__tags tags">

          

          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/swing/">swing</a>, <a class="tags-link" href="/tags/加载动画/">加载动画</a>, <a class="tags-link" href="/tags/开源小工具/">开源小工具</a>
            </font>
          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <h3 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h3><p>一直很疑惑java怎么实现进度条,最近工作需要找到了一个前人实现的swing加载动画,现在整理下来,一为备份,二为后人之路.  </p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h3><p>下面是所需要的工具类InfiniteProgressPanel:</p>
<pre><code>import java.awt.Color;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.RenderingHints;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.awt.font.FontRenderContext;
import java.awt.font.TextLayout;
import java.awt.geom.AffineTransform;
import java.awt.geom.Area;
import java.awt.geom.Ellipse2D;
import java.awt.geom.Point2D;
import java.awt.geom.Rectangle2D;

import javax.swing.JComponent;
/**
 * 加载动画类
 */
public class InfiniteProgressPanel extends JComponent implements MouseListener {
private static final long serialVersionUID = 1L;
protected Area[] ticker = null;
protected Thread animation = null;
protected boolean started = false;
protected int alphaLevel = 0;
protected int rampDelay = 300;
protected float shield = 0.70f;
protected String text = &quot;&quot;;
protected int barsCount = 14;
protected float fps = 15.0f;

protected RenderingHints hints = null;

public InfiniteProgressPanel() {
    this(&quot;&quot;);
}

public InfiniteProgressPanel(String text) {
    this(text, 14);
}

public InfiniteProgressPanel(String text, int barsCount) {
    this(text, barsCount, 0.70f);
}

public InfiniteProgressPanel(String text, int barsCount, float shield) {
    this(text, barsCount, shield, 15.0f);
}

public InfiniteProgressPanel(String text, int barsCount, float shield, float fps) {
    this(text, barsCount, shield, fps, 300);
}

public InfiniteProgressPanel(String text, int barsCount, float shield, float fps, int rampDelay) {
    this.text = text;
    this.rampDelay = rampDelay &gt;= 0 ? rampDelay : 0;
    this.shield = shield &gt;= 0.0f ? shield : 0.0f;
    this.fps = fps &gt; 0.0f ? fps : 15.0f;
    this.barsCount = barsCount &gt; 0 ? barsCount : 14;

    this.hints = new RenderingHints(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_QUALITY);
    this.hints.put(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
    this.hints.put(RenderingHints.KEY_FRACTIONALMETRICS, RenderingHints.VALUE_FRACTIONALMETRICS_ON);
}

public void setText(String text) {
    repaint();
    this.text = text;
}

public String getText() {
    return text;
}

public void start() {
    addMouseListener(this);
    setVisible(true);
    ticker = buildTicker();
    animation = new Thread(new Animator(true));
    animation.start();
}

public void stop() {
    if (animation != null) {
        animation.interrupt();
        animation = null;
        animation = new Thread(new Animator(false));
        animation.start();
    }
}

public void interrupt() {
    if (animation != null) {
        animation.interrupt();
        animation = null;

        removeMouseListener(this);
        setVisible(false);
    }
}

@Override
public void paintComponent(Graphics g) {
    if (started) {
        int width = getWidth();
        int height = getHeight();

        double maxY = 0.0;

        Graphics2D g2 = (Graphics2D) g;
        g2.setRenderingHints(hints);

        g2.setColor(new Color(255, 255, 255, (int) (alphaLevel * shield)));
        g2.fillRect(getWidth()/4, getHeight()/4, getWidth()/2, getHeight()/2);

        for (int i = 0; i &lt; ticker.length; i++) {
            int channel = 224 - 128 / (i + 1);
            g2.setColor(new Color(channel, channel, channel, alphaLevel));
            g2.fill(ticker[i]);

            Rectangle2D bounds = ticker[i].getBounds2D();
            if (bounds.getMaxY() &gt; maxY) {
                maxY = bounds.getMaxY();
            }
        }

        if (text != null &amp;&amp; text.length() &gt; 0) {
            FontRenderContext context = g2.getFontRenderContext();
            TextLayout layout = new TextLayout(text, getFont(), context);
            Rectangle2D bounds = layout.getBounds();
            g2.setColor(Color.BLACK);
            layout.draw(g2, (float) (width - bounds.getWidth()) / 2,
                    (float) (maxY + layout.getLeading() + 2 * layout.getAscent()));
        }
    }
}

private Area[] buildTicker() {
    Area[] ticker = new Area[barsCount];
    Point2D.Double center = new Point2D.Double((double) getWidth() / 2, (double) getHeight() / 2);
    double fixedAngle = 2.0 * Math.PI / (barsCount);

    for (double i = 0.0; i &lt; barsCount; i++) {
        Area primitive = buildPrimitive();

        AffineTransform toCenter = AffineTransform.getTranslateInstance(center.getX(), center.getY());
        AffineTransform toBorder = AffineTransform.getTranslateInstance(45.0, -6.0);
        AffineTransform toCircle = AffineTransform.getRotateInstance(-i * fixedAngle, center.getX(), center.getY());

        AffineTransform toWheel = new AffineTransform();
        toWheel.concatenate(toCenter);
        toWheel.concatenate(toBorder);

        primitive.transform(toWheel);
        primitive.transform(toCircle);

        ticker[(int) i] = primitive;
    }

    return ticker;
}

private Area buildPrimitive() {
    Rectangle2D.Double body = new Rectangle2D.Double(6, 0, 30, 12);
    Ellipse2D.Double head = new Ellipse2D.Double(0, 0, 12, 12);
    Ellipse2D.Double tail = new Ellipse2D.Double(30, 0, 12, 12);

    Area tick = new Area(body);
    tick.add(new Area(head));
    tick.add(new Area(tail));

    return tick;
}

protected class Animator implements Runnable {
    private boolean rampUp = true;

    protected Animator(boolean rampUp) {
        this.rampUp = rampUp;
    }

    @Override
    public void run() {
        Point2D.Double center = new Point2D.Double((double) getWidth() / 2, (double) getHeight() / 2);
        double fixedIncrement = 2.0 * Math.PI / (barsCount);
        AffineTransform toCircle = AffineTransform.getRotateInstance(fixedIncrement, center.getX(), center.getY());

        long start = System.currentTimeMillis();
        if (rampDelay == 0) {
            alphaLevel = rampUp ? 255 : 0;
        }

        started = true;
        boolean inRamp = rampUp;

        while (!Thread.interrupted()) {
            if (!inRamp) {
                for (int i = 0; i &lt; ticker.length; i++) {
                    ticker[i].transform(toCircle);
                }
            }

            repaint();

            if (rampUp) {
                if (alphaLevel &lt; 255) {
                    alphaLevel = (int) (255 * (System.currentTimeMillis() - start) / rampDelay);
                    if (alphaLevel &gt;= 255) {
                        alphaLevel = 255;
                        inRamp = false;
                    }
                }
            } else if (alphaLevel &gt; 0) {
                alphaLevel = (int) (255 - (255 * (System.currentTimeMillis() - start) / rampDelay));
                if (alphaLevel &lt;= 0) {
                    alphaLevel = 0;
                    break;
                }
            }

            try {
                Thread.sleep(inRamp ? 10 : (int) (1000 / fps));
            } catch (InterruptedException ie) {
                break;
            }
            Thread.yield();
        }

        if (!rampUp) {
            started = false;
            repaint();

            setVisible(false);
            removeMouseListener(InfiniteProgressPanel.this);
        }
    }
}

@Override
public void mouseClicked(MouseEvent e) {
}

@Override
public void mousePressed(MouseEvent e) {
}

@Override
public void mouseReleased(MouseEvent e) {
}

@Override
public void mouseEntered(MouseEvent e) {
}

@Override
public void mouseExited(MouseEvent e) {
}
}  
</code></pre><h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><pre><code>InfiniteProgressPanel glasspane = new InfiniteProgressPanel(&quot;加载中,请稍后...&quot;,9,0.3f,21,5);
Dimension dimension = Toolkit.getDefaultToolkit().getScreenSize();
glasspane.setBounds(0, 0, dimension.width , dimension.height );
glasspane.start();//启动加载效果
jFrame.add(glasspane);//此处也可以使用jFrame.setGlassPane(glasspane)但是不明应用场景可能出现动画异常效果.
new Thread() {//进程停顿几秒,模拟加载动画展示时间
     public void run() {
       for (int i = 0; i &lt;= 30; i++) {
           try {
               Thread.sleep(100);
               } catch (InterruptedException e) {
                e.printStackTrace();
                     }
                    }
                  glasspane.stop();
                }
             }.start();
</code></pre><p>其中InfiniteProgressPanel构造函数第一个参数为加载图标下面的文字提示,第二个参数为圆圈动画中bars数量,第三个参数为透明度,范围0到1,0为全透明,第四个参数为fps,每秒显示多少帧动画,为了让圆圈看起来在转动建议设为21,最后一个参数为rampDelay,可以模拟出加载过程中卡顿的效果,使得加载过程更加真实.</p>

  </section>

  <section class="post-comments">

    <!-- 将评论系统（例如Disqus、多说、友言、畅言等）提供的代码片段粘贴在这里 -->
    
</section>


</article>


            <footer class="footer">

    <span class="footer__copyright">Copyright © 2017 zlgao
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    <script src="/js/spirit.js"></script>

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->
</body>
</html>
